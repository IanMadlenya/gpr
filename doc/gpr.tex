\documentclass[12pt]{article}

\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{accents}

\DeclareMathAlphabet{\mathsfsl}{OT1}{cmss}{m}{sl}

\newcommand{\myu}[1]{\underaccent{\bar}{#1}}

\newcommand{\onehalf}{\tfrac{1}{2}}

\newcommand{\mat}[1]{\mbox{$\mathsfsl{#1}$}}
\renewcommand{\vec}[1]{\mbox{\boldmath$#1$}}

\newcommand{\diagv}[1]{\mathrm{diag_v}(#1)}
\newcommand{\diagm}[1]{\mathrm{diag_m}(#1)}
\newcommand{\trace}[1]{\mathrm{tr}(#1)}
\newcommand{\transv}[1]{\vec{#1}^\top}
\newcommand{\transm}[1]{\mat{#1}^\top}

\newcommand{\imat}[1]{\mat{#1^{-1}}}
\newcommand{\ichol}[1]{\mat{#1^{-\onehalf}}}
\newcommand{\icholt}[1]{\mat{#1^{-\tfrac{\top}{2}}}}

\newcommand{\Km}{\mat{K_M}}
\newcommand{\iKm}{\imat{K_M}}
\newcommand{\dKm}{\mat{\dot{K}_M}}
\newcommand{\dkn}{\mat{\dot{K}_N}}
\newcommand{\Kmn}{\mat{K_{MN}}}
\newcommand{\Knm}{\transm{K_{MN}}}
\newcommand{\uKnm}{\myu{\mat{K}}_{\mathsfsl{MN}}^\top}
\newcommand{\uuKnm}{\myu{\myu{\mat{K}}}_{\mathsfsl{MN}}^\top}
\newcommand{\dKmn}{\mat{\dot{K}_{MN}}}
\newcommand{\uKmn}{\myu{\mat{K}}_{\mathsfsl{MN}}}
\newcommand{\uuKmn}{\myu{\myu{\mat{K}}}_{\mathsfsl{MN}}}

\newcommand{\dE}{\dot{E}}

\newcommand{\vecs}{\vec{s}}
\newcommand{\vect}{\vec{t}}
\newcommand{\vecu}{\vec{u}}
\newcommand{\vecv}{\vec{v}}
\newcommand{\vecw}{\vec{w}}
\newcommand{\vecy}{\vec{y}}
\newcommand{\uuvecy}{\myu{\myu{\vec{y}}}}

\newcommand{\vecsd}{\vec{\dot{s}}}
\newcommand{\vecis}{\vec{s}^{-1}}
\newcommand{\veciss}{\vec{s}^{-\onehalf}}

\newcommand{\matB}{\mat{B}}
\newcommand{\matS}{\mat{S}}
\newcommand{\matT}{\mat{T}}
\newcommand{\matU}{\mat{U}}
\newcommand{\matV}{\mat{V}}
\newcommand{\matW}{\mat{W}}

\newcommand{\Lam}{\mat{\Lambda}}
\newcommand{\Lami}{\mat{\Lambda^{-1}}}

\begin{document}

\section{FIC computations}

These are computations of the FIC-likelihood as used in the
OCaml-implementation.  The implementation factorizes the computations
in exactly that way to minimize computation time.  Numerical stability
may still need to be improved.

\begin{itemize}
\item $\mathrm{diag_m}$ is the matrix consisting of only the diagonal
\end{itemize}

\begin{eqnarray*}
\matV & = & \icholt{K_M}\Kmn \\
\mat{Q_N} & = & \transm{V} \matV \\
\Lam & = & \diagm{\mat{K_N} - \mat{Q_N}} \\
\uKmn & = & \Kmn \ichol{\Lambda} \\
\uuKmn & = & \uKmn\ichol{\Lambda} \\
\matB & = & \Km + \uKmn\uKnm \\
\matS & = & \imat{K_M} - \imat{B} \\
\matT & = & \ichol{B}\uuKmn \\
\matU & = & \icholt{B}\matT \\
\matW & = & \ichol{K_M}\mat{V} \\
\vecs & = & \diagv{\Lam} \\
\vecsd & = & \onehalf\diagv{\dkn} + \transm{W}(\onehalf\dKm W - \dKmn) \\
\vect & = & \diagv{\transm{T}\matT} - \vecis \\
\vecu & = & \matU \vecy \\
\vecv & = & (\Knm \vecu - \vecy) \otimes \vecis \\
\vecw & = & \vecv \otimes \vecv \\
\mu_* & = & \mat{K_{*M}} \vecu \\
\sigma^2_* & = & K_* - \mat{K_{*M}}\matS\mat{K_{M*}} \\
E_1 & = & \onehalf (\log|\Km| - \log|\matB| - \log|\Lam| - N \log 2\pi) \\
E_2 & = & \onehalf \vecv\cdot\vecy \\
E & = & E_1 + E_2 \\
\dE_1 & = & \vect\cdot\vecsd + \onehalf\trace{\matS\dKm} - \trace{\transm{U}\dKmn} \\
\dE_2 & = & \vecw\cdot\vecsd - \vecu\cdot(\dKm \onehalf \vecu + \dKmn \vecv) \\
\dE & = & \dE_1 + \dE_2 \\
\end{eqnarray*}

\end{document}
